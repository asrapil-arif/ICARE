
@{
	if (Request.QueryString["recid"] != null)
	{

		ViewBag.Title = "Procurement";
		ViewBag.Parent = "Procurement";
		ViewBag.Child = "Procurement";
		ViewBag.Parent_Caption = "<a href='" + @Request.Url.GetLeftPart(UriPartial.Authority) + "/Procurement'>Procurement</a>";
		//ViewBag.Child_Caption = "<a href='" + @Request.Url.GetLeftPart(UriPartial.Authority) + "/Procurement'>Procurement</a>";
		ViewBag.Icon = "<i class=\"ace-icon fa fa-cart-arrow-down\"></i>";
		ViewBag.TopMenuAce = "Yes";



		<script>

			var recid = '@Context.Request.QueryString["recid"].ToString()';
			var from_add = "1";
			var global_status = "0";
			var StatusRef = "";
			var lsting_stat = "";
			var selected_contract_id = 0;

			var TempDelete = [];
			var current_proc = [];
			var InvVendorId = "0";
			var FLAG_VIEW = "";
			var isMainPage = false;
			var GetMetodePenunjukanList_ = [];
			var flagCrudEcontract = "";
			var current_contract = [];
			var cur_proc_addendum = 0;
			var cur_contract_addendum = "";

			var GetContractGroup_ = [];
			var ContractType_ = [];
			var ContractSigningOfficer_ = [];
			var FungsiName_ = [];
			var ContractVendor_ = [];
			var DocumentType_ = [];
			var SuscribeType_ = [];
			var curr_winner = [];


			var get_data_proc = $.ajax({
				url: URL_PTPR + '/Procurement/FindProcurement?KeyWords=' + recid + '&Field=Id',
				type: 'GET',
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
			});

			current_proc = get_data_proc.responseJSON[0];
			//console.log(current_proc);
			FLAG_VIEW = "VIEW";
			set_sub_child_breadcrumb("View Detail On New Tab");


			function back_main_page() {

				window.close();

			}

			function fill_data() {


				if (GetContractGroup_.length == 0) {
					var GetContractGroup = $.ajax({
						url: URL_PTPR + '/Contract/GetEContractGroup_V2',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});

					GetContractGroup_ = GetContractGroup.responseJSON;
					///console.log(GetContractGroup_);
				}

				if (ContractType_.length == 0) {
					var ContractType = $.ajax({
						url: URL_PTPR + '/Contract/GetContractType',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});

					ContractType_ = ContractType.responseJSON;
					//console.log(ContractType_);
				}

				if (ContractSigningOfficer_.length == 0) {
					var ContractSigningOfficer = $.ajax({
						url: URL_PTPR + '/Contract/GetOfficer',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});

					ContractSigningOfficer_ = ContractSigningOfficer.responseJSON;
					//console.log(ContractSigningOfficer_);
				}

				if (FungsiName_.length == 0) {
					var FungsiName = $.ajax({
						url: URL_PTPR + '/Contract/GetFungsi',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});
					FungsiName_ = FungsiName.responseJSON;
				}

				if (ContractVendor_.length == 0) {
					var ContractVendor = $.ajax({
						url: URL_PTPR + '/Contract/GetVendor',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});

					ContractVendor_ = ContractVendor.responseJSON;
				}

				if (DocumentType_.length == 0) {
					var DocumentType = $.ajax({
						url: URL_PTPR + '/Contract/GetCustomerContractDocType',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});

					DocumentType_ = DocumentType.responseJSON;
				}

				if (SuscribeType_.length == 0) {
					var SuscribeType = $.ajax({
						url: URL_PTPR + '/Contract/GetCustomerSubscribeType',
						type: 'GET',
						dataType: "json",
						cache: false,
						async: false,
						contentType: false,
						processData: false,
					});
					SuscribeType_ = SuscribeType.responseJSON;
				}

			}

			fill_data();


		</script>
	}
	else
	{

		Layout = null;

		<script>

			if (typeof FLAG_VIEW !== 'undefined') {

				set_sub_child_breadcrumb("View Detail");


			}
			else {
				window.close();
			}
		
		</script>

	}

}




@using I_Care.Models
@{
	var ROLES = new I_Care.Classes.UserRoleProvider();

}

<style>

	#page_prcorurement_detail {
	}

		#page_prcorurement_detail .form-horizontal {
			padding: 2%;
			padding-top: 1%;
			transition: 0.2s;
		}

			#page_prcorurement_detail .form-horizontal label {
				font-size: 12px;
			}

		#page_prcorurement_detail .wording_header {
			font-size: 16px;
			padding: 6px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: "...";
		}

		#page_prcorurement_detail .footer_form {
			text-align: center;
			border-top: 1px solid #dedede;
			padding-top: 10px;
			margin-bottom: 10px;
		}

		#page_prcorurement_detail .tab-content {
			border: none !important;
			border-top: 1px solid #dedede !important;
			padding: 0px !important;
			height: 100% !important;
		}


	#ModProcurement .control-label,
	#ModalInvitation .control-label,
	#ModalReject .control-label,
	#ModalRpp .control-label,
	#ModalNego .control-label,
	#ModalTunjuk .control-label,
	#ModalSanggup .control-label,
	#ModalUploadFile .control-label {
		font-size: 12px;
	}



	#ModalInvAttactment .modal-dialog,
	#ModalInvitation .modal-dialog,
	#ModalVendor .modal-dialog,
	#ModalUploadFile .modal-dialog {
		width: 70%;
		margin: 0 auto;
		margin-top: 5%;
	}

	#ModalVendor .modal-dialog {
		width: 75%;
		margin-top: 4%;
	}

	#ModalReject .modal-dialog {
		margin-top: 10%;
		width: 50%;
	}

	#ModalRpp .modal-dialog {
		width: 50%;
		margin-top: 10%;
	}

	#ModalContract .modal-dialog {
		margin: 0 auto;
		margin-top: 8%;
		width: 60%;
	}

	#ModalNego .modal-dialog {
		margin: 0 auto;
		margin-top: 10%;
		width: 60%;
	}

	#ModalTunjuk .modal-dialog {
		margin: 0 auto;
		margin-top: 10%;
		width: 60%;
	}

	#ModalSanggup .modal-dialog {
		margin: 0 auto;
		margin-top: 10%;
		width: 60%;
	}

	#gridContract td {
		text-align: left;
	}

	.input-group-addon:hover {
		color: blue;
	}

	#page_prcorurement_detail .wording_header_form {
		padding: 10px;
		width: 90%;
		margin: 1% auto;
		border-bottom: 1px dashed #dedede;
		text-align: center;
		line-height: 25px;
		font-size: 13px !important;
	}

	#ModalContract .icon_short_cut {
		width: 120px;
		height: 140px;
	}

		#ModalContract .icon_short_cut .fa {
			font-size: 35px;
		}

	.judul_proses_kontrak {
		font-size: 15px;
		padding: 10px;
	}

	.modal-title {
		font-size: 16px !important;
	}

	#frame_prevviewProc {
		background-position: center;
		background-repeat: no-repeat;
		height: 100%;
	}
</style>


@if (Request.QueryString["recid"] != null)
	{
	<div id="PageContainer"></div>
}


<div id="page_prcorurement_detail" hidden>

	<div class="wording_header">


		<span style="font-size:14px;">
			Add New Procurement Tracking
		</span>


	</div>

	<div class="tabbable" id="tab_prcorurement_detail">
		<ul class="nav nav-tabs" id="myTabProc">

			<li class="active">
				<a data-toggle="tab" href="#info_Proc" aria-expanded="true" style="border-left:none;">
					<i class="fa fa-desktop"></i>
					Main Info.
				</a>
			</li>

			<li class="" id="tab_upload_captionProc">
				<a data-toggle="tab" href="#tab_uploadProc" aria-expanded="true">
					<i class="fa fa-file"></i>
					Upload File
				</a>
			</li>
			<li class="" id="tab_upload_list_captionProc">
				<a data-toggle="tab" href="#tab_upload_listProc" aria-expanded="true">
					<i class="fa fa-file"></i>
					Upload File List
				</a>
			</li>

			<li class="" id="tab_list_invitation_caption">
				<a data-toggle="tab" href="#tab_list_invitation" aria-expanded="true">
					<i class="fa fa-paper-plane-o"></i>  Invitation List
				</a>
			</li>

			<li class="" id="tab_rpp_caption">
				<a data-toggle="tab" href="#tab_rpp" aria-expanded="true">
					<i class="fa fa-file-text" "></i>  Hasil Rapat Penjelasan
				</a>
			</li>

			<li class="" id="tab_nego_caption">
				<a data-toggle="tab" href="#tab_nego" aria-expanded="true">
					<i class="fa fa-file-text" "></i>  Hasil Negosiasi
				</a>
			</li>

			<li class="" id="tab_tunjuk_caption">
				<a data-toggle="tab" href="#tab_tunjuk" aria-expanded="true">
					<i class="fa fa-file-text" "></i>  Summary BA Penunjukan
				</a>
			</li>


			<li class="" id="tab_sanggup_caption">
				<a data-toggle="tab" href="#tab_sanggup" aria-expanded="true">
					<i class="fa fa-file-text" "></i>  Summary BA Kesanggupan
				</a>
			</li>


			<li id="tab_contract_proc_caption">
				<a data-toggle="tab" href="#tab_contract_proc" aria-expanded="true">
					<i class="fa fa-list"></i>  Contract List
				</a>
			</li>

			<li class="" id="tab_historyProc">
				<a data-toggle="tab" href="#list_historyProc" aria-expanded="false">
					<i class="fa fa-history"></i>
					Log.
				</a>
			</li>

		</ul>

		<div class="tab-content">
			<div id="info_Proc" class="tab-pane fade active in" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">

						<div class="form-group" id="group_procId">
							<label for="inputName" class="col-sm-2 control-label input">Procurement Id.</label>
							<div class="col-sm-4">
								<input class="form-control" id="ProcId" placeholder="Procurement Id. Will be generate by system" type="text" readonly style="background-color:whitesmoke;">
							</div>
						</div>


						<div class="form-group select_wajib">

							<label for="inputName" class="col-sm-2 control-label input">Metode Penunjukan <mandatory>*</mandatory></label>
							<div class="col-sm-10">



								<select class="form-control select2 wajib" id="MetodePenunjukan" placeholder="Pilih Metode Penunjukan">
									<option value="" selected>-- Pilih Metode Penunjukan --</option>
									@foreach (var item in ViewBag.MetodePenunjukan)
									{

										<option value="@item.LookId">@item.LookName</option>

									}
								</select>

							</div>
						</div>


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Title <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input class="form-control input wajib" id="Title" type="text" placeholder="Disarankan judul sama dengan judul pada memo pengadaan !" onkeypress="if (event.keyCode == 13){$('#Descriptions').focus();}" autocomplete="off">
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Descriptions <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control input wajib" id="Descriptions" placeholder="Tinggalkan keterangan yang lengkap" onkeypress="if (event.keyCode == 13){$('#RiskAssesmentKategori').focus();}" autocomplete="off" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:80px;"> </textarea>
							</div>
						</div>

						<div class="form-group select_wajib">
							<label for="inputName" class="col-sm-2 control-label">Risk Assesment <mandatory>*</mandatory></label>
							<div class="col-sm-10">

								<select class="form-control select2 wajib" id="RiskAssesmentKategori" placeholder="Pilih Level Risk Assesment">
									<option value="" selected>-- Pilih Level Risk Assesment --</option>
									<option value="Low">Low</option>
									<option value="Medium">Medium</option>
									<option value="High">High</option>
								</select>
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Expected Date <mandatory>*</mandatory></label>
							<div class="col-sm-4">
								@*<input id="ExpectedDate" class="form-control date-picker" type="date" placeholder="Expected Date">*@
								<input id="ExpectedDate" class="form-control input wajib" type="text" style="height:28px;" placeholder="Perkiraan tanggal pengadaan" onkeypress="if (event.keyCode == 13){$('#FungsiName').focus();}" autocomplete="off">


							</div>
							<label for="inputName" class="col-sm-2 control-label">Fungsi Name <mandatory>*</mandatory></label>
							<div class="col-sm-4 select_wajib">

								<select class="form-control select2 input" id="FungsiName" onchange="$('#ProcurementDate').focus()">
									<option value="" selected>-- Select Fungsi --</option>
									@foreach (var item in ViewBag.Fungsi)
									{

										<option value="@item.LookId">@item.LookName</option>

									}
								</select>

							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Procurement Value <mandatory>*</mandatory></label>
							<div class="col-sm-4">
								<input type="text" id="temp_ProcurementValue" hidden />

								<input style="font-weight:bold;" class="form-control input wajib" id="ProcurementValue" placeholder="Procurement Value." type="text" onselect="format_currencyproc('ProcurementValue','temp_ProcurementValue')" onkeyup="format_currencyproc('ProcurementValue','temp_ProcurementValue')" onmouseup="format_currencyproc('ProcurementValue','temp_ProcurementValue')" onkeypress="if (event.keyCode == 13){$('#ExpectedDate').focus();}" autocomplete="off">

							</div>

							<label for="inputName" class="col-sm-2 control-label">PR No.</label>
							<div class="col-sm-4">
								<input class="form-control" id="PrNo" placeholder="PR No." type="text" onkeypress="if (event.keyCode == 13){$('#ProcurementValue').focus();}" autocomplete="off">
							</div>

						</div>



						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Remark</label>
							<div class="col-sm-10">

								<textarea class="form-control input" placeholder="Dapat Anda abaikan jika keterangan / deskripsi diatas sudah cukup." id="Remark" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:50px;" autocomplete="off"></textarea>

							</div>
						</div>


					</div>
				</form>

			</div>




			<div id="tab_uploadProc" class="tab-pane fade" style="padding:15%;padding-top:15px !important;padding-bottom:10px !important;">

				<form class="form-horizontal">
					<div class="box-body">

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label">Memo Permohonan <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_memo_permohonan" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>


						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label">Termn of Reference <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_tor" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label">Risk Assesment <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_ra" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>


						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label">OE <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_oe" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>



						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label">TKDN <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_tkdn" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>


						<div class="form-group upload_wajib" id="ip_upload">
							<label for="inputName" class="col-sm-2 control-label">Izin Prinsip <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_izin_prinsip" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>

						<div class="form-group upload_wajib" id="bq_upload">
							<label for="inputName" class="col-sm-2 control-label">BQ <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="file_bq" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">PR</label>
							<div class="col-sm-10">
								<input type="file" id="file_pr" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>


					</div>
				</form>

			</div>

			<div id="tab_upload_listProc" class="tab-pane fade" style="padding:0px;padding-top:1px;">
				<div id="gridUploadProc" class="data_grid" style="height:297px;border:none;border-radius:0px;border-top:1px solid #dedede;border-right:0px solid #dedede;"></div>
			</div>

			<div id="tab_list_invitation" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="gridInvitation" class="data_grid" style="height:299px;border:none;border-radius:0px;border-top:1px solid #dedede;border-right:0px solid #dedede;"></div>

			</div>

			<div id="tab_rpp" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="rpp_fill" style="border:1px solid #dedede;margin:10px;padding:10px;height:250px;overflow-y:scroll;background-color:#fdfde9;">


				</div>

			</div>
			<div id="tab_nego" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="nego_fill" style="border:1px solid #dedede;margin:10px;padding:10px;height:250px;overflow-y:scroll;background-color:#fdfde9;">


				</div>

			</div>

			<div id="tab_tunjuk" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="tunjuk_fill" style="border:1px solid #dedede;margin:10px;padding:10px;height:250px;overflow-y:scroll;background-color:#fdfde9;">


				</div>

			</div>

			<div id="tab_sanggup" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="sanggup_fill" style="border:1px solid #dedede;margin:10px;padding:10px;height:250px;overflow-y:scroll;background-color:#fdfde9;">


				</div>

			</div>

			<div id="tab_alert_configProc" class="tab-pane fade" style="padding:0px;padding-top:0px;">



				<table border="0" width="100%" align="center" cellpadding="0" cellspacing="0">

					<tr>
						<td width="60%" valign="top" style="padding-top:1px;">
							<div id="gridEmailProc" style="height:298px;border:none;border-radius:0px;border-top:1px solid #ccc;border-right:0px solid #dedede;"></div>
						</td>
						<td valign="top" style="border-left:1px solid #ccc;">
							<div id="setting_boxProc" style="padding:10px;padding-top:30px;">



								<div style="font-size:20px;padding-left:10px;">Alert Setting</div><br />

								<div class="form-group">
									<label for="inputName" class="col-sm-4 control-label">Enabled Alert</label>
									<div class="col-sm-6">


										<div class="col-xs-2">

											<label>
												<input name="switch-field-1" class="ace ace-switch" type="checkbox" id="Snooze" />
												<span class="lbl"></span>
											</label>
										</div>

									</div>
								</div>

								<div class="form-group">
									<label for="inputName" class="col-sm-4 control-label">Start From</label>
									<div class="col-sm-6">

										<input type="text" id="AlertDay" readonly />

										<span class="lbl" style="font-size:11px;">Day before contract expire</span>

									</div>
								</div>

							</div>
						</td>

					</tr>
				</table>

			</div>

			<div id="tab_contract_proc" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="gridContractProc" class="data_grid" style="height:299px;border:none;border-radius:0px;border-top:1px solid #dedede;border-right:0px solid #dedede;"></div>

			</div>

			<div id="list_historyProc" class="tab-pane fade" style="padding:0px;padding-top:1px;">

				<div id="gridHitoryProc" class="data_grid" style="height:299px;border:none;border-radius:0px;border-top:1px solid #dedede;border-right:0px solid #dedede;"></div>

			</div>


		</div>
	</div>

	<div class="footer_form">

	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalInvitation" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title"><i class="fa fa-paper-plane-o" aria-hidden="true" style="color:dodgerblue;"></i> Tambah Undangan</h4>
			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Tujuan Undangan <mandatory>*</mandatory></label>
							<div class="col-sm-10">

								<div class="input-group">

									<input class="form-control inv_field wajib" id="inv_to" placeholder="Disarankan untuk diisi dengan nama calon vendor !" type="text" onkeypress="if (event.keyCode == 13){$('#inv_contact_person').focus();}" autocomplete="off">

									<span class="input-group-addon" id="isi_manual" style="cursor:pointer;" onclick="isi_manual_vendor();">
										<i class="fa fa-pencil-square-o"></i> <span style="font-size:11px;">Isi Manual</span>
									</span>

									<span class="input-group-addon" id="find_vendor" style="cursor:pointer;" onclick="find_vendor();">
										<i class="fa fa-search bigger-110"></i> <span style="font-size:11px;">Cari Dari I-Vend</span>
									</span>

								</div>

							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Contact Person <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input class="form-control inv_field wajib" id="inv_contact_person" type="text" placeholder="" onkeypress="if (event.keyCode == 13){$('#inv_phone').focus();}" autocomplete="off">
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Phone <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input class="form-control inv_field wajib" id="inv_phone" type="text" placeholder="" onkeypress="if (event.keyCode == 13){$('#inv_email').focus();}" autocomplete="off">
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Alamat Email <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input class="form-control inv_field wajib" id="inv_email" type="text" placeholder="Disarankan untuk diisi dengan alamat email calon vendor" onkeypress="if (event.keyCode == 13){$('#inv_alamat').focus();}" autocomplete="off">
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Alamat <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control inv_field wajib" id="inv_alamat" placeholder="Disarankan untuk diisi dengan ikhtisar undangan" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:100px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Descriptions</label>
							<div class="col-sm-10">
								<textarea class="form-control" id="inv_description" placeholder="Disarankan untuk diisi dengan ikhtisar undangan" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:50px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label mandatory">File<mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_undangan" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" multiple />
							</div>
						</div>
					</div>
				</form>

			</div>
			<div class="modal-footer">

				<button type="button" class="btn btn-primary  btn-sm" onclick="save_invitation()">Add</button>
				<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

			</div>
		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalReject" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<div class="modal-title" style="font-size:16px;">Tinggalkan alasan kenapa pengajuan ini direject !</div>

			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Tujuan Reject <mandatory>*</mandatory></label>
							<div class="col-sm-10 select_wajib">

								<select class="form-control select2 input" id="TujuanReject">
									<option value="" selected>-- Select Fungsi --</option>
								</select>

							</div>

						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Alasan Reject <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control wajib" id="proc_rejct_reason" placeholder="* Tinggalkan keterangan kenapa pengajuan ini direject !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>


					</div>
				</form>
			</div>

		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-danger btn-sm" onclick="save_procurement('REJECT')">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalRpp" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">Update Rapat Penjelasan</h4>

			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Summary <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control wajib" id="proc_rpp_reason" placeholder="* Tinggalkan summary dari hasil rapat penjelasan !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label mandatory">File &nbsp;&nbsp;:</label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_rpp" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" multiple />
							</div>
						</div>

					</div>
				</form>

			</div>




		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-primary btn-sm" onclick="save_procurement('RPP')">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalNego" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">Update Hasil Negosiasi</h4>

			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Summary <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control wajib" id="proc_nego_reason" placeholder="* Tinggalkan summary dari hasil negosiasi !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Nilai Pengajuan</label>
							<div class="col-sm-10">
								<input type="text" id="temp_negotiation_value" hidden />
								<input class="form-control wajib" type="text" id="nilai_pengajuan" placeholder="" autocomplete="off" readonly>
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Nilai Negosiasi <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="text" id="temp_negotiation_value" hidden />
								<input class="form-control wajib" type="text" id="negotiation_value" placeholder="* Nilai yang disepakati setelah dilakukan negosiasi " autocomplete="off" onkeyup="format_currency('negotiation_value','temp_negotiation_value')" onmouseup="format_currency('negotiation_value','temp_negotiation_value')">
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">File</label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_nego" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" multiple />
							</div>
						</div>

					</div>
				</form>
			</div>

		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-primary btn-sm" onclick="save_procurement('NEGO')">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalTunjuk" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">Update BA Penunjukan</h4>

			</div>

			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Summary <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control wajib" id="proc_tunjuk_reason" placeholder="* Tinggalkan keterangan penunjukan !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">File</label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_tunjuk" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" multiple />
							</div>
						</div>

					</div>

				</form>
			</div>


		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-primary btn-sm" onclick="save_procurement('PENUNJUKAN')">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalSanggup" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">Update BA Kesanggupan</h4>

			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Summary <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<textarea class="form-control wajib" id="proc_sanggup_reason" placeholder="* Tinggalkan keterangan kesanggupan !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label mandatory">File</label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_sanggup" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" multiple />
							</div>
						</div>

					</div>
				</form>

			</div>

		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-primary btn-sm" onclick="save_procurement('KESANGGUPAN')">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>


<div class="modal fade" id="ModalUploadFile" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">Uploda File Pendukung</h4>

			</div>
			<div class="modal-body" style="padding:10px;">

				<form class="form-horizontal">
					<div class="box-body">

						<div class="form-group select_wajib">
							<label for="inputName" class="col-sm-2 control-label mandatory">Pilih Tipe Dokumen<mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<select class="form-control select2" id="proc_file_pendukung_doc_type" onchange="$('#proc_file_pendukung_upload').focus()">
									<option value="" selected>-- Pilih Tipe Dokumen--</option>

									@foreach (var item in ViewBag.DocTypeList)
									{

										<option value="@item.Id">@item.DocType</option>

									}
									<option value="12" selected>File Lain-Lain</option>
								</select>
							</div>
						</div>

						<div class="form-group upload_wajib">
							<label for="inputName" class="col-sm-2 control-label mandatory">File <mandatory>*</mandatory></label>
							<div class="col-sm-10">
								<input type="file" id="proc_file_pendukung_upload" required accept=".jpg,.jpeg,.pdf,.png,.xls" class="uploader" />
							</div>
						</div>


						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label mandatory">Keterangan  &nbsp;&nbsp;:</label>
							<div class="col-sm-10">
								<textarea class="form-control" id="proc_file_pendukung_desc" placeholder="Tinggalkan keterangan jika perlu !" style="color:#333;resize:none;font-size:11px;padding-left:3px;height:150px;background-color:#faffbc;font-size:14px;" autocomplete="off"></textarea>
							</div>
						</div>

					</div>
				</form>
			</div>

		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-primary btn-sm" onclick="save_upload_file()">Ok</button>
			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>

		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalVendor" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Pilih Vendor</h4>
				<span style="font-size:11px;">Double click on item or select an item and click select button  !</span>
			</div>
			<div class="modal-body" style="padding:0px;">

				<div id="gridVendor" style="height:390px;border:none;border-radius:0px;border-top:1px solid #dedede;border-right:0px solid #dedede;"></div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary  btn-sm" " onclick="select_vendor()">Select</button>
			</div>
		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="ModalInvAttactment" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content" style="border:none;">
			<div class="modal-header">
				<h4 class="modal-title">List Attachment For Invited Vendor !</h4>
			</div>
			<div class="modal-body" style="padding:0px;">

				<div id="gridAttachmentIvitedVendor" style="border-radius:0px;border:none;border-top:1px solid #ccc;height:299px;" class="responsive"></div>

			</div>

		</div>
		<div class="modal-footer">

			<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>

		</div>
	</div>
</div>




<script>

	var Global_File_Uploaded = [];
	var file_memo_permohonan = [];
	var file_tor = [];
	var file_ra = [];
	var file_oe = [];
	var file_tkdn = [];
	var file_izin_prinsip = [];
	var file_bq = [];
	var file_pr = [];

	var SelectedInvId = 0;
	var curr_count_winner = 0;


</script>

<script>

	//
	$('.data_grid').css('height', Number(window.innerHeight) - 263);
	$('#page_prcorurement_detail .tab-content').css('min-height', Number(window.innerHeight) - 260);
	$('#frame_prevviewProc').css('height', Number(window.innerHeight) - 265);

	$(window).resize(function () {
		$('.data_grid').css('height', Number(window.innerHeight) - 263);
		$('#page_prcorurement_detail .tab-content').css('min-height', Number(window.innerHeight) - 260);
		$('#frame_prevviewProc').css('height', Number(window.innerHeight) - 265);
	});




	var allow_action = [];

	function procurement_detail_form() {


		$('a[href="#info_Proc"]').tab('show');
		$('#ExpectedDate').w2field('date', { format: 'yyyy/mm/dd' });
		$("#proc_rejct_reason").val("");
		$("#proc_rpp_reason").val("");
		$("#proc_tunjuk_reason").val("");
		$("#tab_rpp_caption").hide();
		$("#tab_nego_caption").hide();
		$("#tab_tunjuk_caption").hide();
		$("#tab_sanggup_caption").hide();
		$("#tab_contract_proc_caption").hide();
		$("#ip_upload").hide();
		$("#frame_prevviewProc").attr("src", "");
		$("#tab_list_invitation_caption").hide();


		switch (FLAG_VIEW) {

			case "ADD":

				Global_File_Uploaded = [];
				current_proc = [];
				set_sub_child_breadcrumb("New Procurement");

				$('#page_prcorurement_detail .form-control').prop('readonly', false);
				$('#page_prcorurement_detail .select2').prop('disabled', false);
				$("#page_prcorurement_detail #group_procId").hide();

				button = '<button type="button" class="btn btn-primary  btn-sm" onclick="save_procurement(\'ADD\')">Save</button> <button type="button" class="btn btn-default btn-sm" onclick="back_main_page();">Cancel</button>'
				$("#page_prcorurement_detail .footer_form").html(button);

				$("#tab_historyProc").hide();
				$("#tab_upload_list_captionProc").hide();
				$("#tab_list_invitation_caption").hide();
				$("#tab_upload_captionProc").show();
				$("#frame_prevviewProc").attr("src", "");

				form_default();

				break;

			case "VIEW":

				$("#page_prcorurement_detail .wording_header").html("Detail Of : #Id:" + current_proc.Id + " #Status:" + current_proc.StatusName + " #Title:" + current_proc.Title);
				form_filling(current_proc);


				var DataSave = new FormData();
				DataSave.append('Id', current_proc.Id);
				var allow_action_ = $.ajax({
					url: URL_PTPR + '/Button/Procurement_AllowAction',
					type: 'POST',
					data: DataSave,
					dataType: "json",
					cache: false,
					async: false,
					contentType: false,
					processData: false,
					processData: false,
				});

				allow_action = allow_action_.responseJSON[0];


				var DataSummary = new FormData();
				DataSummary.append('ProcId', current_proc.Id);

				var DataSummary_Get = $.ajax({
					url: URL_PTPR + '/Procurement/GetSummary',
					type: 'POST',
					data: DataSummary,
					dataType: "json",
					cache: false,
					async: false,
					contentType: false,
					processData: false,
				});

				//responseJSON
				rec_summary = DataSummary_Get.responseJSON[0];
				curr_count_winner = rec_summary.CountWinner;

				$('#page_prcorurement_detail .form-control').prop('readonly', true);
				$('#page_prcorurement_detail .select2').prop('disabled', true);

				$("#page_prcorurement_detail #group_procId").show();
				$("#tab_upload_captionProc").hide();
				$("#tab_upload_list_captionProc").show();
				$("#tab_historyProc").show();

				if (allow_action.LastProcess >= 2) { $("#tab_list_invitation_caption").show(); render_grid_invitation(); }
				if (allow_action.LastProcess >= 3) { $("#tab_rpp_caption").show(); $("#rpp_fill").html(rec_summary.RppSummary); }
				if (allow_action.LastProcess >= 4) { $("#tab_nego_caption").show(); $("#nego_fill").html(rec_summary.NegotiationSummary); }
				if (allow_action.LastProcess >= 8) { $("#tab_tunjuk_caption").show(); $("#tunjuk_fill").html(rec_summary.PenunjukanSummary); }
				if (allow_action.LastProcess >= 9) { $("#tab_sanggup_caption").show(); $("#sanggup_fill").html(rec_summary.KesanggupanSummary); }
				if (allow_action.LastProcess >= 10) { $("#tab_contract_proc_caption").show(); render_grid_contract_proc(); }

				if (current_proc.Status == 12) {
					$('#page_prcorurement_detail .form-control').prop('readonly', false);
					$('#page_prcorurement_detail .select2').prop('disabled', false);
				}

				render_grid_upload();

				$("#page_prcorurement_detail .modal-title").html('<i class="fa fa-list-ul" aria-hidden="true"></i> ' + "Detail Pengajuan : #" + current_proc.Id + "<i class='fa fa-arrow-right' aria-hidden='true'></i> #" + current_proc.StatusName + "<i class='fa fa-arrow-right' aria-hidden='true'></i> #Create By: " + current_proc.CreateUser + " On " + current_proc.CreateDate);


				var DataSave = new FormData();
				DataSave.append('Id', current_proc.Id);
				var allow_button = $.ajax({
					url: URL_PTPR + '/Button/Procurement_AllowButton',
					type: 'POST',
					data: DataSave,
					dataType: "json",
					cache: false,
					async: false,
					contentType: false,
					processData: false,
					processData: false,
				});



				button_cancel = ' <button type="button" class="btn tn-default btn-sm" onclick="back_main_page();">Cancel</button>';
				button_action = allow_button.responseText;

				$("#page_prcorurement_detail .footer_form").html(button_action + button_cancel)



				break;



		}


		$('#ProcId').prop('disabled', true);
		$("#page_prcorurement_detail").show();


	}

	function form_default() {

		$("#ProcId").val("");
		$("#Title").val("");
		$("#Descriptions").val("");
		$("#FungsiName").val("").trigger('change');
		$("#PrNo").val("");
		$("#ExpectedDate").val("");
		$("#ProcurementDate").val("");
		$("#Remark").val("");
		$("#temp_ProcurementValue").val("");
		$("#ProcurementValue").val("");
		$("#MetodePenunjukan").val("").trigger('change');


	}

	function form_filling(record) {

		$("#ProcId").val(record.recid);
		$("#Title").val(record.Title);
		$("#Descriptions").val(record.Descriptions);
		$("#FungsiName").val(record.Function).trigger('change');
		$("#PrNo").val(record.NoPR);
		$("#ExpectedDate").val(record.ExpectedDate);
		$("#Remark").val(record.Remark);
		$("#RiskAssesmentKategori").val(record.RiskAssesment).trigger('change');
		$("#ProcurementValue").val(record.Value);//arif

		$("#MetodePenunjukan").val(record.MetodePenunjukan).trigger('change');
		format_currencyproc("ProcurementValue", "temp_ProcurementValue")

	}


	function render_grid_upload() {



		if (w2ui['gridUploadProc'] != null) {
			w2ui['gridUploadProc'].destroy();
		}

		toolBar = allow_action.AllowResubmit;

		$('#gridUploadProc').w2grid({
			name: 'gridUploadProc',
			show: {
				footer: true,
				lineNumbers: true,
				toolbarAdd: true,
				toolbarDelete: true,
				toolbarInput: false,
				toolbarReload: false,
				toolbarColumns: false,
				toolbar: toolBar,
			},
			columns: [
				{ field: 'DocType', text: 'Document Type', size: '200px' },
				{ field: 'FileName', text: 'File Name', size: '70%' },
				{
					field: 'FileName', text: '', size: '20%',
					render: function (record) {
						debugger
						var download = '<a href="' + URL_PTR + '/File/ViewAttachment/' + record.Id + '" target="_blank"><i class="fa fa-cloud-download" aria-hidden="true" ></i> Download</a>';
						return download;
					}
				},

			],
			onAdd: function (event) {

				$("#proc_file_pendukung_doc_type").val("").trigger('change');
				$("#proc_file_pendukung_desc").val("");
				var file_ = $('#proc_file_pendukung_upload');
				file_.ace_file_input('reset_input');

				$('#ModalUploadFile').on('shown.bs.modal', function () {
				});

				$('#ModalUploadFile').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

			},
			onReload: function (event) {
				//refresh_upload_Proc($("#ProcId").val());
			},
			//onSelect: function (event) {


			//	if (event.recid != undefined) {
			//		var record = this.get(event.recid);
			//		var file_url = URL_PTR + "/File/ViewAttachment/" + record.Id;
			//		$("#frame_prevviewProc").attr("src", file_url);

			//	}

			//},
			//onUnselect: function (event) {

			//	$("#frame_prevviewProc").attr("src", "");
			//},
			onDelete: function (event) {

				var sel = this.getSelection();
				if (event.force == true) {

					render_wait();

					sel.forEach(function (entry) {

						var record = w2ui.gridUploadProc.get(entry);

						var Delete = $.ajax({
							url: URL_PTR + '/Procurement/DeleteFilePendukung/' + record.recid,
							type: 'POST',
							dataType: "json",
							cache: false,
							async: false,
							contentType: false,
							processData: false,
						});


					});


					clear_wait();
					$('#modal_uploadProc').modal("hide");

				}

			},

		});

		refresh_upload_Proc();
		render_grid_history();
	}

	function refresh_upload_Proc() {

		Id = current_proc.recid;
		w2ui['gridUploadProc'].load(URL_PTR + '/Procurement/ProcurementFile/' + Id);


	}


	function render_grid_history() {

		if (w2ui['gridHitoryProc'] != null) {
			w2ui['gridHitoryProc'].destroy();
		}

		$('#gridHitoryProc').w2grid({
			name: 'gridHitoryProc',
			url: URL_PTR + '/Procurement/LogProcess/' + current_proc.Id,
			show: {
				header: false,
				footer: true,
				lineNumbers: false,
				toolbarAdd: true,
				toolbarDelete: true,
			},
			columns: [
				{ field: 'FromName', text: 'From', size: '200px', info: true },
				{ field: 'ToName', text: 'To', size: '200px' },
				{ field: 'Descriptions', text: 'Note', size: '300px' },
				{ field: 'Executor', text: 'Executor', size: '100%' },
			]
		});

	}


	function render_grid_invitation() {


		toolBar = allow_action.AllowInvite;

		if (w2ui['gridInvitation'] != null) {
			w2ui['gridInvitation'].destroy();
		}

		$('#gridInvitation').w2grid({
			name: 'gridInvitation',
			url: URL_PTR + '/Procurement/InvitationList/' + current_proc.Id,
			show: {
				header: false,
				footer: true,
				toolbarAdd: true,
				toolbarDelete: true,
				lineNumbers: true,
				selectColumn: true,
				toolbar: toolBar,
			},
			columns: [
				{ field: 'InvToName', text: 'Nama Tujuan', size: '200px', info: true },
				{ field: 'InvContactPerson', text: 'Contact Person', size: '100px' },
				{ field: 'InvPhone', text: 'Phone', size: '100px' },
				{ field: 'InvMail', text: 'Email', size: '100px' },
				{ field: 'InvAddress', text: 'Address', size: '100px' },
				{ field: 'InvDescription', text: 'Description', size: '100px' },
				{ field: 'UsulanPemenangName', text: 'Usulan', size: '250px' },
				{
					field: 'FileName', text: 'Attachment', size: '100%',
					render: function (record) {
						debugger
						var download = '<a href="#" onclick="list_attachment_inv(\'' + record.Id + '\')"><i class="fa fa-list" aria-hidden="true" ></i> Attachment List</a>';
						return download;
					}
				},
			],
			onAdd: function (event) {

				var file_inv = $('#proc_file_undangan');
				file_inv.ace_file_input('reset_input');
				$(".inv_field").prop('readonly', false);
				$("#isi_manual").hide();
				$("#inv_to").val("");
				$("#inv_email").val("");
				$("#inv_description").val("");
				$("#inv_contact_person").val("");
				$("#inv_phone").val("");
				$("#inv_alamat").val("");

				InvVendorId = "0";

				$('#ModalInvitation').on('shown.bs.modal', function () {
					$("#inv_to").focus();
				});

				$('#ModalInvitation').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);



			},
			onDelete: function (event) {


				var sel = this.getSelection();
				if (event.force == true) {



					sel.forEach(function (entry) {

						var record = w2ui.gridInvitation.get(entry);

						var Simpan = $.ajax({
							url: URL_PTR + '/Procurement/DeleteInvitation/' + record.Id,
							type: 'POST',
							dataType: "json",
							cache: false,
							async: false,
							contentType: false,
							processData: false,
						});

					});




				}

			},
		});

	}

	function list_attachment_inv(Id) {

		//ModalInvAttactment
		//gridAttachmentIvitedVendor
		SelectedInvId = Id;

		if (w2ui['gridAttachmentIvitedVendor'] != null) { w2ui['gridAttachmentIvitedVendor'].destroy(); }

		$('#ModalInvAttactment').on('shown.bs.modal', function () {

			$('#gridAttachmentIvitedVendor').w2grid({

				name: 'gridAttachmentIvitedVendor',
				url: URL_PTPR + '/Procurement/AttachmentInvitedVendorList?Id=' + SelectedInvId + '&ProcId=' + current_proc.Id,
				show: {
					header: false,
					footer: true,
					lineNumbers: true,
					toolbarAdd: false,
					toolbarDelete: false,
					toolbar: true,
					toolbarSearch: false,
				},
				toolbar: {
					items: [
						//{ type: 'button', id: 'view_attachment', caption: '<i class="fa fa-folder-open" aria-hidden="true" style="color:orange;"></i> View Attachment Beside of Draft', disabled: true },
						//{ type: 'break' },
						{ type: 'button', id: 'view_in_new_tab', text: '<i class="fa fa-external-link" aria-hidden="true" style="color:green;"></i> Lihat File', disabled: true },
					],
					onClick: function (target, data) {

						switch (target) {

							case 'view_in_new_tab':
								var sel = w2ui.gridAttachmentIvitedVendor.getSelection();
								var record = w2ui.gridAttachmentIvitedVendor.get(sel[0]);
								var file_url = "";
								if (record.API == "DocMan") {
									file_url = URL_PTPR + "/EContract/ViewAttachment?Id=" + record.ID;
								}
								else {
									file_url = URL_PTPR + '/File_Contract/' + record.FileName_org;
								}

								window.open(file_url, '_blank');
								break;

						}

					}
				},
				columns: [

					{ field: 'DocType', text: 'Tipe Dokumen', size: '200px', searchable: 'text' },
					{ field: 'FileName', text: 'File Name', size: '100%', searchable: 'text' }

				],
				onDblClick: function (event) {

					var record = this.get(event.recid);
					var file_url = "";
					if (record.API == "DocMan") {
						file_url = URL_PTPR + "/EContract/ViewAttachment?Id=" + record.ID;
					}
					else {
						file_url = URL_PTPR + '/File_Contract/' + record.FileName_org;
					}

					window.open(file_url, '_blank');
				},
				onSelect: function (event) {

					event.onComplete = function () {
						var contract = w2ui.gridAttachmentIvitedVendor.getSelection();
						//w2ui['gridLampiran'].toolbar.disable('view_attachment');
						w2ui['gridAttachmentIvitedVendor'].toolbar.disable('view_in_new_tab');

						if (contract.length == 1) {
							var record = this.get(event.recid);
							//w2ui['gridLampiran'].toolbar.enable('view_attachment');
							w2ui['gridAttachmentIvitedVendor'].toolbar.enable('view_in_new_tab');

						}
					}

				},
				onUnselect: function (event) {

					event.onComplete = function () {
						var contract = w2ui.gridAttachmentIvitedVendor.getSelection();
						//w2ui['gridLampiran'].toolbar.disable('view_attachment');
						w2ui['gridAttachmentIvitedVendor'].toolbar.disable('view_in_new_tab');

						if (contract.length == 1) {

							var record = this.get(event.recid);
							//w2ui['gridLampiran'].toolbar.enable('view_attachment');
							w2ui['gridAttachmentIvitedVendor'].toolbar.enable('view_in_new_tab');

						}
					}
				}


			});
		})

		$('#ModalInvAttactment').modal(
			{
				backdrop: 'static',
				keyboard: false
			}
		);

	}

	function render_grid_contract_proc() {

		if (w2ui['gridContractProc'] != null) {
			w2ui['gridContractProc'].destroy();
		}

		$('#gridContractProc').w2grid({
			name: 'gridContractProc',
			textSearch: 'contains',
			url: URL_PTR + '/Procurement/FindContractByProcId/' + current_proc.Id,
			show: {

				header: false,
				toolbar: false,
				footer: true,
				lineNumbers: true,
				selectColumn: true,
				toolbarSearch: false,
				toolbarAdd: false
			},

			columns: [

				{ field: 'DayAlert', text: 'Info.', size: '200px', sortable: true, searchable: 'text', resizable: true, info: true },
				{ field: 'ContractId', text: 'Contract Id.', size: '150px', sortable: true, searchable: 'text', resizable: true, },
				{ field: 'ContractNo', text: 'Contract No.', size: '150px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'ContractTitle', text: 'Title', size: '300px', resizable: true, sortable: true, searchable: 'text', style: 'word-wrap:break-word;' },
				{ field: 'BeginDate', text: 'Start Date', size: '100px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'EndDate', text: 'End Date', size: '100px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'Files', text: 'Attachment', size: '100px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'AlertDestination', text: 'Mail Destination', size: '150px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'ContractValue', text: '<div style="text-align:right;">Value (Rp.)</div>', size: '100px', resizable: true, sortable: true, searchable: 'text', render: 'number' },
				{ field: 'ContractTypeName', text: 'Contract Type', size: '100px', resizable: true, sortable: true, searchable: 'text' },
				{ field: 'PenanggungJawabPihak1', text: 'Contract Signing Officer', size: '100px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'FungsiName', text: 'Fungsi', size: '100px', sortable: true, searchable: 'text', resizable: true },
				{ field: 'Creator', text: 'Creator', size: '100px', resizable: true, sortable: true, searchable: 'text', max: '400px' },
				{ field: 'Updater', text: 'Updater', size: '100%', resizable: true, sortable: true, searchable: 'text', max: '400px' },

			],

		});

	}


	function save_procurement(CURRENT_FLAG) {


		FLAG_CRUD = CURRENT_FLAG;
		var MetodePenunjukan = $("#MetodePenunjukan").val();
		var DocTypeCode = 0;
		var ModalActive = "";

		if ($("#MetodePenunjukan").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#MetodePenunjukan").focus();
			w2alert("Metode Penunjukan may not be empty !");

			return;

		}

		if ($("#Title").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#Title").focus(); -
				w2alert("Title No may not be empty !");
			return;

		}

		if ($("#Title").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#Title").focus();
			w2alert("Title No may not be empty !");
			return;

		}

		if ($("#Descriptions").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#Descriptions").focus();
			w2alert("Descriptions No may not be empty !");

			return;

		}

		if ($("#RiskAssesmentKategori").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#RiskAssesmentKategori").focus();
			w2alert("Risk Assesment Category may not be empty !");

			return;

		}

		if ($("#ExpectedDate").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#ExpectedDate").focus();
			alert("ExpectedDate Date is empty!");

			return;

		}

		if ($("#FungsiName").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#FungsiName").focus();
			alert("Fungsi may not be empty !");

			return;

		}

		if ($("#ProcurementValue").val() == "") {

			$('a[href="#info_Proc"]').tab('show');
			$("#ProcurementValue").focus();
			w2alert("Procurement Value may not be empty !");

			return;

		}

		//if ($("#PrNo").val() == "") {

		//	$('a[href="#info_Proc"]').tab('show');
		//	$("#PrNo").focus();
		//	w2alert("PR may not be empty !");

		//	return;

		//}



		if (FLAG_CRUD == "INVITE") {

			var ListInvite = w2ui['gridInvitation'].records;

			if (ListInvite.length < 1) {
				w2alert("Anda tidak dapat menandai pengajuan ini telah diinvite karena list invitation masih kosong, silahkan diisi terlebih dahulu !");
				$('a[href="#tab_list_invitation"]').tab('show');
				return;
			}

		}



		if (FLAG_CRUD == "REJECT") {

			ModalActive = "ModalReject";

			$('#TujuanReject').empty();

			var RejectDest = $.ajax({
				url: URL_PTPR + '/Procurement/GetProcurementRejectDestination/' + current_proc.Id,
				type: 'GET',
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
			});

			RejectDest_ = RejectDest.responseJSON;

			$("#TujuanReject").append('<option value="" selected>--Pilih Tujuan Reject --</option>');

			$.each(RejectDest_, function (i, item) {
				$("#TujuanReject").append('<option value="' + RejectDest_[i].Id + '">' + RejectDest_[i].Name + '</option>');
			});

			$("#TujuanReject").trigger("change");


			if ($("#proc_rejct_reason").val() == "") {
				$('#ModalReject').on('shown.bs.modal', function () {
					$("#proc_rejct_reason").focus();
				});

				$('#ModalReject').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#proc_rejct_reason").focus();

				return;
			}

		}


		if (FLAG_CRUD == "RPP") {

			ModalActive = "ModalRpp";
			if ($("#proc_rpp_reason").val() == "") {
				$('#ModalRpp').on('shown.bs.modal', function () {
					$("#proc_rpp_reason").focus();
				});

				$('#ModalRpp').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#proc_rpp_reason").focus();

				return;
			}

		}


		if (FLAG_CRUD == "NEGO") {

			ModalActive = "ModalNego";
			if ($("#proc_nego_reason").val() == "") {

				$('#ModalNego').on('shown.bs.modal', function () {
					nilai_pengajuan = numberWithCommas(current_proc.Value);
					$("#nilai_pengajuan").val(nilai_pengajuan);
					$("#proc_nego_reason").focus();
				});

				$('#ModalNego').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#proc_nego_reason").focus();

				return;
			}


			if ($("#negotiation_value").val() == "") {

				$('#ModalNego').on('shown.bs.modal', function () {
					$("#negotiation_value").focus();
				});

				$('#ModalNego').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#negotiation_value").focus();

				return;
			}

		}

		if (FLAG_CRUD == "USUL") {


			var ListUsul = w2ui['gridInvitation'].getSelection();


			if (ListUsul.length < 1) {
				w2alert("Harap check list 1 atau lebih  usulan pemenang pada list undangan !");
				$('a[href="#tab_list_invitation"]').tab('show');
				return;
			}


		}


		if (FLAG_CRUD == "PENGUMUMAN") {


			var ListUsul = w2ui['gridInvitation'].getSelection();



			if (ListUsul.length < 1) {
				w2alert("Harap check list 1  pemenang saja pada list undangan !");
				$('a[href="#tab_list_invitation"]').tab('show');
				return;
			}


			if (ListUsul.length == 1) {

				rec_inv = w2ui['gridInvitation'].get(ListUsul[0]);

				if (rec_inv.Status == 0) {

					w2alert("Harap pilih pemenang yang telah diusulkan !");
					$('a[href="#tab_list_invitation"]').tab('show');
					return;

				}
			}

		}

		if (FLAG_CRUD == "PENUNJUKAN") {

			ModalActive = "ModalTunjuk";
			if ($("#proc_tunjuk_reason").val() == "") {
				$('#ModalTunjuk').on('shown.bs.modal', function () {
					$("#proc_tunjuk_reason").focus();
				});

				$('#ModalTunjuk').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#proc_tunjuk_reason").focus();

				return;
			}

		}

		if (FLAG_CRUD == "KESANGGUPAN") {

			ModalActive = "ModalSanggup";
			if ($("#proc_sanggup_reason").val() == "") {
				$('#ModalSanggup').on('shown.bs.modal', function () {
					$("#proc_sanggup_reason").focus();
				});

				$('#ModalSanggup').modal(
					{
						backdrop: 'static',
						keyboard: false
					}
				);

				$("#proc_sanggup_reason").focus();

				return;
			}

		}







		if (FLAG_CRUD == "ADD") {


			if (file_memo_permohonan.length == 0) {

				w2alert("Harap sertakan file memo permohonan !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}

			if (file_tor.length == 0) {

				w2alert("Harap sertakan file term of reference !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}

			if (file_ra.length == 0) {

				w2alert("Harap sertakan file risk assesment !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}


			if (file_oe.length == 0) {

				w2alert("Harap sertakan file OE !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}


			if (file_tkdn.length == 0) {

				w2alert("Harap sertakan file TKDN !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}

			if (MetodePenunjukan == 3) {

				if (file_izin_prinsip.length == 0) {

					w2alert("Harap sertakan file Izin Prinsip !");
					$('a[href="#tab_uploadProc"]').tab('show');
					return;

				}
			}

			if (file_bq.length == 0) {

				w2alert("Harap sertakan file BQ !");
				$('a[href="#tab_uploadProc"]').tab('show');
				return;

			}

			//if (file_pr.length == 0) {

			//	w2alert("Harap sertakan file PR !");
			//	$('a[href="#tab_uploadProc"]').tab('show');
			//	return;

			//}


		}



		var DataSave = new FormData();

		DataSave.append('FlagCrud', FLAG_CRUD);
		DataSave.append('ProcId', $("#ProcId").val());
		DataSave.append('Title', $("#Title").val());
		DataSave.append('Descriptions', $("#Descriptions").val());
		DataSave.append('Function', $("#FungsiName").val());
		DataSave.append('PrNo', $("#PrNo").val());
		DataSave.append('ExpectedDate', $("#ExpectedDate").val());
		DataSave.append('ProcurementDate', $("#ProcurementDate").val());
		DataSave.append('Value', $("#temp_ProcurementValue").val());
		DataSave.append('Vendor', "");
		DataSave.append('Remark', $("#Remark").val());
		DataSave.append('NegotiationValue', "0");
		DataSave.append('MetodePenunjukan', MetodePenunjukan);
		DataSave.append('RiskAssesmentKategori', $("#RiskAssesmentKategori").val());



		switch (FLAG_CRUD) {

			case "ADD":

				if (file_memo_permohonan.length > 0) {
					for (var i = 0; i < file_memo_permohonan.length; i++) {
						var row_draft = file_memo_permohonan[i];
						Global_File_Uploaded.push(row_draft);
					}
				}

				if (file_tor.length > 0) {
					for (var i = 0; i < file_tor.length; i++) {
						var row_draft = file_tor[i];
						Global_File_Uploaded.push(row_draft);
					}
				}


				if (file_ra.length > 0) {
					for (var i = 0; i < file_ra.length; i++) {
						var row_draft = file_ra[i];
						Global_File_Uploaded.push(row_draft);
					}
				}

				if (file_oe.length > 0) {
					for (var i = 0; i < file_oe.length; i++) {
						var row_draft = file_oe[i];
						Global_File_Uploaded.push(row_draft);
					}
				}


				if (file_tkdn.length > 0) {
					for (var i = 0; i < file_tkdn.length; i++) {
						var row_draft = file_tkdn[i];
						Global_File_Uploaded.push(row_draft);
					}
				}


				if (file_izin_prinsip.length > 0) {
					for (var i = 0; i < file_izin_prinsip.length; i++) {
						var row_draft = file_izin_prinsip[i];
						Global_File_Uploaded.push(row_draft);
					}
				}


				if (file_bq.length > 0) {
					for (var i = 0; i < file_bq.length; i++) {
						var row_draft = file_bq[i];
						Global_File_Uploaded.push(row_draft);
					}
				}

				if (file_pr.length > 0) {
					for (var i = 0; i < file_pr.length; i++) {
						var row_draft = file_pr[i];
						Global_File_Uploaded.push(row_draft);
					}
				}


				DataSave.append('FileUploadList', JSON.stringify(Global_File_Uploaded));


				break;

			case "REJECT":
				DataSave.append('Reason', $("#proc_rejct_reason").val());
				break;
			case "RPP":

				var upload_file = $("#proc_file_rpp").get(0).files;
				DocTypeCode = 8;

				if (upload_file.length > 0) {

					//DataSave.append("8", file_rpp[0]);
					for (var i = 0; i < upload_file.length; i++) {

						DataSave.append(upload_file[i].name, upload_file[i]);
					}

				}

				DataSave.append('Reason', $("#proc_rpp_reason").val());
				break;

			case "NEGO":

				var upload_file = $("#proc_file_nego").get(0).files;
				DocTypeCode = 9;
				if (upload_file.length > 0) {

					//DataSave.append("9", file_rpp[0]);
					for (var i = 0; i < upload_file.length; i++) {

						DataSave.append(upload_file[i].name, upload_file[i]);
					}
				}

				DataSave.append('Reason', $("#proc_nego_reason").val());
				DataSave.append('NegotiationValue', $("#temp_negotiation_value").val());

				break;

			case "USUL":

				var ListUsul = w2ui['gridInvitation'].getSelection();
				var recordUsul = [];

				ListUsul.forEach(function (entry) {
					var feed = { "Id": entry };
					recordUsul.push(feed);

				});

				DataSave.append('Reason', JSON.stringify(recordUsul));
				break;

			case "PENGUMUMAN":

				var ListUsul = w2ui['gridInvitation'].getSelection();
				var recordUsul = [];

				ListUsul.forEach(function (entry) {
					var feed = { "Id": entry };
					recordUsul.push(feed);

				});

				DataSave.append('Reason', JSON.stringify(recordUsul));
				break;

			case "PENUNJUKAN":
				var upload_file = $("#proc_file_tunjuk").get(0).files;
				DocTypeCode = 10
				if (upload_file.length > 0) {

					//DataSave.append("8", file_rpp[0]);
					for (var i = 0; i < upload_file.length; i++) {

						DataSave.append(upload_file[i].name, upload_file[i]);
					}

				}
				DataSave.append('Reason', $("#proc_tunjuk_reason").val());
				break;

			case "KESANGGUPAN":

				var upload_file = $("#proc_file_sanggup").get(0).files;
				DocTypeCode = 11;
				if (upload_file.length > 0) {

					for (var i = 0; i < upload_file.length; i++) {

						DataSave.append(upload_file[i].name, upload_file[i]);
					}

				}


				DataSave.append('Reason', $("#proc_sanggup_reason").val());
				break;

			default:
				DataSave.append('Reason', "-");

		}




		DataSave.append('DocTypeCode', DocTypeCode);

		if (ModalActive != "") $("#" + ModalActive).modal("hide");
		$("#page_prcorurement_detail").hide();
		$('#Saving_Load').show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTR + '/Procurement/SaveProcurement',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Error, try again or contact our administrator please !", "Saving Procurement Tracking");
					$("#page_prcorurement_detail").show();
					if (ModalActive != "") $("#" + ModalActive).modal("show");
					$('#Saving_Load').hide();

				}
			});


			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				$('#Saving_Load').hide();
				$("#page_prcorurement_detail").show();
				if (ModalActive != "") $("#" + ModalActive).modal("show");
				w2alert(Simpan.responseJSON["Result"]);
			}
			else {


				w2alert("Save data success !");
				$('#Saving_Load').hide();
				if (ModalActive != "") $("#" + ModalActive).modal("hide");
				back_main_page();
			}


		});


	}



	function save_invitation() {




		if ($("#inv_to").val() == "") {
			$("#inv_to").focus();
			w2alert("Tujuan undangan harus diinput !");
			return;

		}

		if ($("#inv_contact_person").val() == "") {
			$("#inv_contact_person").focus();
			w2alert("Contact person harus diinput !");
			return;

		}

		if ($("#inv_phone").val() == "") {
			$("#inv_phone").focus();
			w2alert("Phone harus diinput !");
			return;

		}

		if ($("#inv_email").val() == "") {
			$("#inv_email").focus();
			w2alert("Email undangan harus diinput !");
			return;

		}

		if ($("#inv_alamat").val() == "") {
			$("#inv_alamat").focus();
			w2alert("Alamat harus diinput !");
			return;

		}


		var file_undangan = $("#proc_file_undangan").get(0).files;
		if (file_undangan.length == 0) {

			w2alert("Harap sertakan file undangan !");
			return;

		}

		var DataSave = new FormData();
		DataSave.append('FlagCrud', 'ADD');
		DataSave.append('ProcId', $("#ProcId").val());
		DataSave.append('InvTo', $("#inv_to").val());
		DataSave.append('InvMail', $("#inv_email").val());
		DataSave.append('InvDescription', $("#inv_description").val());
		DataSave.append('InvContactPerson', $("#inv_contact_person").val());
		DataSave.append('InvPhone', $("#inv_phone").val());
		DataSave.append('InvAlamat', $("#inv_alamat").val());
		DataSave.append('InvVendorId', InvVendorId);


		if (file_undangan.length > 0) {

			for (var i = 0; i < file_undangan.length; i++) {

				DataSave.append(file_undangan[i].name, file_undangan[i]);
			}

		}

		$("#ModalInvitation").modal("hide");
		$("#page_prcorurement_detail").hide();
		$('#Saving_Load').show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTR + '/Procurement/SaveInvitation',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Error, try again or contact our administrator please !", "Saving Procurement Tracking");
					$("#ModalInvitation").modal("show");
					$("#page_prcorurement_detail").show();
					$('#Saving_Load').hide();

				}
			});


			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				$('#Saving_Load').hide();
				$("#ModalInvitation").modal("show");
				$("#page_prcorurement_detail").show();
				w2alert(Simpan.responseJSON["Result"]);
			}
			else {

				w2alert("Undangan berhasil ditambahakan");
				w2ui['gridInvitation'].reload();
				$('#Saving_Load').hide();
				$("#ModalInvitation").modal("hide");
				$("#page_prcorurement_detail").show();
			}


		});


	}


	function save_upload_file() {

		if ($("#proc_file_pendukung_doc_type").val() == "") {
			$("#proc_file_pendukung_doc_type").focus();
			w2alert("Tipe Dokumen harus dipilih !");
			return;

		}

		var file_pendukung = $("#proc_file_pendukung_upload").get(0).files;
		if (file_pendukung.length == 0) {
			w2alert("Harap sertakan file pendukung yang akan diupload !");
			return;

		}

		var DocType_ = $("#proc_file_pendukung_doc_type").val();
		var DocTypeRec = w2ui['gridUploadProc'].find({ DocTypeId: DocType_ });


		if (DocType_ != 12) {
			//check double file
			if (DocTypeRec.length > 0) {
				w2alert("Ops Dokumen degan tipe ini sudah pernah diupload, hapus terlebih dahulu file sebelumnya atau pilih tipe dokumen lain-lain !");
				return;
			}
		}


		var DataSave = new FormData();
		DataSave.append('FlagCrud', 'ADD');
		DataSave.append('ProcId', $("#ProcId").val());
		DataSave.append('DocType', $("#proc_file_pendukung_doc_type").val());
		DataSave.append('Descriptions', $("#proc_file_pendukung_desc").val());


		if (file_pendukung.length > 0) {
			DataSave.append("fiependukung", file_pendukung[0]);
		}

		$('#Modal_load_2').show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTR + '/Procurement/SaveFilePendukung',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
			});


			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				$('#Modal_load_2').hide();
				w2alert(Simpan.responseJSON["Result"]);
			}
			else {

				w2alert("File berhasil !");
				refresh_upload_Proc();
				$('#Modal_load_2').hide();
				$("#ModalUploadFile").modal("hide");
			}


		});


	}

	function isi_manual_vendor() {

		InvVendorId = "0";
		$("#inv_to").val("");
		$("#inv_contact_person").val("");
		$("#inv_phone").val("");
		$("#inv_email").val("");
		$("#inv_alamat").val("");
		$("#inv_to").focus();
		$('.inv_field').prop('readonly', false);

	}


	function find_vendor() {



		if (w2ui['gridVendor'] != null) {
			w2ui['gridVendor'].destroy();
		}


		$('#ModalVendor').modal(
			{
				backdrop: 'static',
				keyboard: false
			}
		);

		$('#ModalVendor').on('shown.bs.modal', function () {
			$('#gridVendor').w2grid({

				name: 'gridVendor',
				multiSelect: false,
				header: 'Daftar Contract',
				textSearch: 'contains',
				show: {
					header: false,
					toolbar: true,
					footer: true,
					toolbarSearch: false,
				},
				columns: [
					{ field: 'Id', text: 'Id', size: '60px', sortable: true, searchable: 'text' },
					{ field: 'VendorId', text: 'Vendor Id.', size: '100px', sortable: true, searchable: 'text' },
					{ field: 'VendorName', text: 'Name', size: '250px', sortable: true, searchable: 'text' },
					{ field: 'Phone1', text: 'Phone', size: '250px', sortable: true, searchable: 'text' },
					{ field: 'Email1', text: 'Mail', size: '250px', sortable: true, searchable: 'text' },
					{ field: 'ContactName', text: 'Contact Person', size: '250px', sortable: true, searchable: 'text' },
					{ field: 'Alamat', text: 'Alamat', size: '100%', sortable: true, searchable: 'text' },
				],
				onDblClick: function (event) {
					select_vendor();
				},
				onLoad: function (event) {

				},
				onReload: function (event) {
					refresh_vendor();
				}

			});


			refresh_vendor();
		})
	}

	function refresh_vendor() {

		w2ui['gridVendor'].load(URL_PTR + '/Procurement/FindVendor');


	}

	function select_vendor() {

		var sel = w2ui.gridVendor.getSelection();
		var record = w2ui.gridVendor.get(sel[0]);
		InvVendorId = record.Id;

		$("#inv_to").val(record.VendorName);
		$("#inv_contact_person").val(record.ContactName);
		$("#inv_phone").val(record.Phone1);
		$("#inv_email").val(record.Email1);
		$("#inv_alamat").val(record.Alamat);
		$("#inv_description").focus();
		//$('.inv_field').prop('readonly', true);
		$("#isi_manual").show();

		$('#ModalVendor').modal("hide");



	}

	//not fucntional core business sytem code ..............***
	$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

		var target = $(e.target).attr("href");

		if ((target == '#list_historyProc')) {
			w2ui['gridHitoryProc'].refresh();
		}
		if ((target == '#tab_alert_configProc')) {
			debugger
			w2ui['gridEmailProc'].refresh();

		}
		if ((target == '#tab_alert_configProcVendor')) {
			debugger
			w2ui['gridSugestVendorProc'].refresh();

		}
		if ((target == '#tab_upload_listProc')) {
			w2ui['gridUploadProc'].refresh();
		}

		if ((target == '#tab_list_invitation')) {
			w2ui['gridInvitation'].refresh();
		}

		if ((target == '#tab_contract_proc')) {
			w2ui['gridContractProc'].refresh();
		}

		//arif
		if ((target == '#tab_uploadProc')) {

			if ($("#MetodePenunjukan").val() == "") {

				$('a[href="#info_Proc"]').tab('show');
				w2alert("Harap pilih metode penunjukan terlebih dahulu !");
			}
		}

	});



	$('#AlertDay').ace_spinner({ value: 0, min: 0, max: 30, step: 1, btn_up_class: 'btn-primary ', btn_down_class: 'btn-primary ' })
		.closest('.ace-spinner')
		.on('changed.fu.spinbox', function () {
		});

	$('.date-picker').datepicker({
		autoclose: true,
		todayHighlight: true,
		format: 'yyyy-mm-dd'
	})


	function format_currencyproc(Field_ID, temp_field) {

		if ($("#" + Field_ID).val() != "") {

			var Nominal = $("#" + Field_ID).val();
			Nominal = Nominal.replace(/,/g, "");
			$("#" + temp_field).val(Nominal);
			var fix_num = numberWithCommas(Nominal);

			$("#" + Field_ID).val(fix_num);

		}
		else {

			$("#" + temp_field).val("");

		}

	}


	function format_currencyprocitem(Field_ID, temp_field) {

		if ($("#" + Field_ID).val() != "") {

			var Nominal = $("#" + Field_ID).val();
			Nominal = Nominal.replace(/,/g, "");
			$("#" + temp_field).val(Nominal);
			var fix_num = numberWithCommas(Nominal);

			$("#" + Field_ID).val(fix_num);

		}
		else {

			$("#" + temp_field).val("");

		}

	}
	function get_volume() {

		var volume = Number($('#temp_nominal').val() / Number($('#price').val())).toFixed(2);
		$('#Volume').val(volume);
		format_currencyproc("Volume", "temp_volume");
		//$('#temp_volume').val(volume);



	}
	function send_alert() {

		var DataSave = new FormData();
		DataSave.append('ProcId', $("#ProcId").val());
		render_wait();

		var Simpan = $.ajax({
			url: URL_PTR + '/Alert/SendAlerProcurement',
			type: 'POST',
			data: DataSave,
			dataType: "json",
			cache: false,
			async: false,
			contentType: false,
			processData: false,
		});

		if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

			clear_wait();
			alert(Simpan.responseJSON["Result"]);

		}
		else {

			alert('Send Alert Success !');
			clear_wait();

		}

	}




	//pre_upload ----------------------------------------

	//file_memo_permohonan
	//file_tor
	//file_ra
	//file_oe
	//file_tkdn
	//file_izin_prinsip
	//file_bq
	//file_pr

	$('#file_memo_permohonan').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_memo_permohonan[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "MEMO_PERMOHONAN");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_memo_permohonan = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {


		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "MEMO_PERMOHONAN");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '1');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_memo_permohonan.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});


	$('#file_tor').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_tor[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "TERM_OF_REFERENCE");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_tor = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {


		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "TERM_OF_REFERENCE");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '2');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_tor.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});


	$('#file_ra').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_ra[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "RISK_ASSESMENT");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_ra = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {


		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "RISK_ASSESMENT");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '3');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_ra.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});


	$('#file_pr').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_pr[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "PR");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_pr = [];
				return true;
			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {


		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "PR");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '4');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_pr.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});


	$('#file_oe').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_oe[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "OE");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_oe = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {


		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "OE");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '5');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_oe.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});




	$('#file_tkdn').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_tkdn[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "TKDN");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_tkdn = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {

		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "TKDN");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '14');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_tkdn.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});




	$('#file_izin_prinsip').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_izin_prinsip[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "IZIN_PRINSIP");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_izin_prinsip = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {

		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "IZIN_PRINSIP");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '6');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_izin_prinsip.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});




	$('#file_bq').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
		before_remove: function () {

			Id = file_bq[0].ID;
			Delete_File = [];
			var row_delete = { ID: Id };
			Delete_File.push(row_delete);

			var DataSave = new FormData();
			DataSave.append('FileCategory', "BQ");
			DataSave.append('FileUploadList', JSON.stringify(Delete_File));

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/DeleteFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {

					w2alert("Hapus File Gagal !");
				}

			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {

				w2alert("Hapus File Gagal !");
				return false;
			}
			else {
				w2alert("File Berhasil Dihapus!");
				file_bq = [];
				return true;

			}
		},
		preview_error: function (filename, error_code) {
		}

	}).on('change', function () {

		var file = this.files[0];
		var file_name = file.name;
		var DataSave = new FormData();
		DataSave.append('FileCategory', "BQ");
		DataSave.append('UPLOAD_FILE', file);
		DataSave.append('Key1', 'PROCUREMENT_FILE');
		DataSave.append('Key2', '13');

		$("#tab_uploadProc .form-horizontal").hide();
		$("#Uploading_Load").show("fade", function () {

			var Simpan = $.ajax({
				url: URL_PTPR + '/Procurement/UploadFilePre',
				type: 'POST',
				data: DataSave,
				dataType: "json",
				cache: false,
				async: false,
				contentType: false,
				processData: false,
				error: function (request, status, error) {
					w2alert("Upload File Gagal !");
					$("#Uploading_Load").hide();
					$("#tab_uploadProc .form-horizontal").show();
				}
			});

			if (Simpan.responseJSON["Result"].toLocaleLowerCase().indexOf("error") != -1) {
				w2alert("Upload File Gagal !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();


			}
			else {

				var row_upload = { ID: Simpan.responseJSON["Result"] };
				file_bq.push(row_upload);
				w2alert("Upload File Berhasil !");
				$("#Uploading_Load").hide();
				$("#tab_uploadProc .form-horizontal").show();

			}

		});


	});


	$("#ModalRpp").on("hidden.bs.modal", function () {
		$("#proc_rpp_reason").val("");
		var file_ = $('#proc_file_rpp');
		file_.ace_file_input('reset_input');
	});

	$("#ModalNego").on("hidden.bs.modal", function () {
		$("#proc_nego_reason").val("");
		var file_ = $('#proc_file_nego');
		file_.ace_file_input('reset_input');
	});

	$("#ModalTunjuk").on("hidden.bs.modal", function () {
		$("#proc_tunjuk_reason").val("");
		var file_ = $('#proc_file_tunjuk');
		file_.ace_file_input('reset_input');
	});

	$("#ModalSanggup").on("hidden.bs.modal", function () {
		$("#proc_sanggup_reason").val("");
		var file_ = $('#proc_file_sanggup');
		file_.ace_file_input('reset_input');
	});

	$("#ModalUploadFile").on("hidden.bs.modal", function () {

		$("#proc_file_pendukung_desc").val("");
		var file_ = $('#proc_file_pendukung_upload');
		file_.ace_file_input('reset_input');

	});


	$('#MetodePenunjukan').on("select2:select", function (e) {

		var opsi = $('#MetodePenunjukan').val();

		if (opsi == 3) {

			$("#ip_upload").show();
		}
		else {

			$("#ip_upload").hide();
		}

	});

	//setting_uploader
	$('#proc_file_rpp,#proc_file_nego,#proc_file_tunjuk,#proc_file_sanggup').ace_file_input({
		btn_choose: 'Browse',
		btn_change: null,
		no_icon: 'ace-icon fa fa-cloud-upload',
		droppable: true,
		thumbnail: 'small',
	})




	function process_contract() {


		if (current_proc.CountWinner == 1) {
			if (current_proc.EContractStatus == 1) {
				w2alert("Pengajuan ini sedang dalam proses E-Kontrak, harap menunggu hingga proses selesai !", "Info.");
				return;
			}
		}
		else {

			if (current_proc.PercentageEKontrak == 100) {
				w2alert("Pengajuan dengan multi winner ini sudah dalam proses E-Kontrak 100%, harap menunggu hingga proses selesai !", "Info.");
				return;
			}
		}

		$("#ModalInvitation,#page_prcorurement_detail").remove();
		load_page("#PageContainer", URL_PTPR + "/Procurement/ProcessContract", function () { $('.select2').css('width', '100%').select2() });

	}


	


	procurement_detail_form();
	isMainPage = false;

</script>



